今天会讲的很快 因为东西多，基础知识之前已经铺垫了。开始： 既然bitcoin支付基于UTXO， 所以主要是2个部分 1 生成bitcoin 地址， 图是我画的。。。首先根据ECDSA（椭圆曲线数字签名）通过privateKey 生成pubkey， 在做一次SHA256 hash  再做一次RIPMO160 把地址缩小到160bits == 40hex 这个结果是publicKeyHash 用于非常重要的一类transaction叫Pay-To-Public-Key-Hash (P2PKH)， 用pkHash 前面 加上 1byte的prefix（用于表明什么类型账户一般是0x00） 用这个结果生成checksum（图中黑块）放到结尾， 最后把整体做一次Base58 encode（编码）就生成了bitcoin address。发送者根据publickeyHash 编写scriptPubkey  这种支付叫Pay To Public Key Hash (P2PKH) 为了彻底了解bitcoin 这里就需要简单说一下 BTC block的样子 这里还是我画的。 块有两个部分 1 header 2. transactions array。header 主要包括本块的previous block hash， merkle root， nonce（随机数 用于POW） time-stamp 等等。 通过HASH256 就可以本块的hash。 transaction包括比如 交易数量n_tx merkle tree array的全部节点， 还有所有的实际transaction array。 而单箭头指出来的是transaction的分解图， 其中包括tx hash， version， locktime（这个用于闪电网络中）， 重点来了 input array 和 output array 等等。 in 的分解图包括prev_out 的 tx hash 和 数组中的index（n）还有 由ECDSA 通过private key生成的数字签名等， out 的分解图 包括 花费value， scriptPubkey等。ex是例子 OP_DUP OP_HASH160 69e...abc (public key hash 这就是为什么我们要通过public key来生成public key hash的原因 因为需要编写scriptPubkey)。 所以在BTC的blockchain 有两种连接 1. block hash 指向之前的块， 2.在input array 中的previous transaction hash 指向之前的UTXO。（注意小区别 block hash 直接指向 之前的块 但是transaction hash并不一定指向前一个块中的transaction） 好！ 有了这些基本的画面在脑子里以后 我们来讲支付的第二个部分： 矿工验证。重点来了 验证就是BTC software 把图中 in 中 scripSig 和 out中scriptPubkey 连起来 依次执行 其 组合成的bitcoin script。验证2步 1. 保证in中指向的之前的UTXO 有效 （n指的是之前out array 中的第几笔， 用于锁定之前的UTXO）2. 运行 bitcoin script。 bitcoin script 是 没有循环的stack 语言 怎么个运行发？ 继续上图 。 图最下面是 实际的script 其中<>是具体的数据， 其他的都是bitcoin script已经写好的运算方式。 规则： 遇到<> 加入到stack中 遇到运算方式 就去拿stack中的数据进行计算。 从左到右的图是计算过程在stack 中的展现，OP_DUP是复制stack的数据，  遇到HASH160计算 其实就是把pubkey 进行RIPMO160 计算（刚刚提过的）然后比较pubkeyHash 两个是否一致 最后OP_CHECKSIG 就是最后检查sig 和 pubkey是不是符合 也就是接受者可否证明自己是真正的接受者。 如果任何一步出错 交易就会无效 否则 就矿工验证成功， 就可以把这笔交易放入block 中。 这就是点对点交易 btc的全部过程 另外还有两种方式 一种是Multisig的 就是需要多个人的数字签名 完整验证 之前讲的是一个人支付一个人Pay To Public Key Hash (P2PKH)的情况。 最后一种才最厉害 这就是为什么以太坊诞生的原因 叫Pay To Script Hash (P2SH) 而产生的目的其实是为了方便支付 因为作为支付一方 你需要准备scriptPubkey 也就是out 中的一堆运算方式 加 对方的publicKeyHash， 而P2SH只需要制定一个script的hash， in中的scriptSig需要指定script 这样把复杂度从支付者转移到被接受者 而接受者可以是人 但是script还是不是可以理解成一段代码 这不就是smart contract么 也就是为什么以太坊可以支付给contract 账户 并与其进行互动了。
链接：https://www.youtube.com/channel/UCNcSSleedtfyDuhBvOQzFzQ
链接：https://en.bitcoin.it/wiki/Transaction
链接：https://bitcoin.org/en/developer-guide#transactions
链接：https://blockchain.info/tx/9021b49d445c719106c95d561b9c3fac7bcb3650db67684a9226cd7fa1e1c1a0?format=hex
